@startuml c4_class
title C4 - Code Level Class Diagram

enum Role {
    staff
    manager
    director
    hr
    admin
}

enum Status {
    To Do
    In Progress
    Done
    Review
    Blocked
}

enum NotificationType {
    APPROACHING_DEADLINE
    TASK_ASSIGNED
    NEW_COMMENT
    MENTION
    TASK_UPDATED
}

class User {
  - user_id: String
  - name: String
  - email: String
  - role: Role
  - manager_id: String
  - handle: String
  - created_at: DateTime
  + getUserById(id: String): User
  + getUserByEmail(email: String): User
  + updateRole(role: Role): void
  + getTeamMembers(): List<User>
}

class Task {
  - task_id: String
  - title: String
  - description: String
  - priority: Integer
  - status: Status
  - due_date: DateTime
  - created_at: DateTime
  - updated_at: DateTime
  - created_by: User
  - assigned_to: User
  - project_id: String
  - tags: List<String>
  - archived: Boolean
  - archived_at: DateTime
  - archived_by: String
  - is_recurring: Boolean
  - recurrence_interval_days: Integer
  - parent_recurring_task_id: String
  - subtask_count: Integer
  - subtask_completed_count: Integer
  + createTask(): Task
  + updateTask(): void
  + archiveTask(user_id: String): void
  + assignTo(user: User): void
  + addTag(tag: String): void
  + addSubtask(subtask: Subtask): void
}

class Project {
  - project_id: String
  - name: String
  - key: String
  - description: String
  - owner_id: String
  - created_at: DateTime
  - updated_at: DateTime
  - archived: Boolean
  + createProject(): Project
  + updateProject(): void
  + addMember(user: User, role: String): void
  + getTasks(): List<Task>
}

class Membership {
  - membership_id: String
  - project_id: String
  - user_id: String
  - role: String
  - created_at: DateTime
  + addMember(): Membership
  + removeMember(): void
  + updateRole(role: String): void
}

class Note {
  - note_id: String
  - task_id: String
  - author_id: String
  - body: String
  - mentions: List<String>
  - created_at: DateTime
  - edited_at: DateTime
  + addNote(): Note
  + editNote(body: String): void
  + deleteNote(): void
  + extractMentions(body: String): List<String>
}

class Subtask {
  - subtask_id: String
  - parent_task_id: String
  - title: String
  - description: String
  - completed: Boolean
  - order: Integer
  + createSubtask(): Subtask
  + updateSubtask(): void
  + toggleComplete(): void
  + deleteSubtask(): void
}

class Attachment {
  - attachment_id: String
  - task_id: String
  - file_name: String
  - file_path: String
  - uploaded_by: String
  - upload_date: DateTime
  + uploadFile(task_id: String, file: File): Attachment
  + downloadFile(): File
  + deleteFile(): void
}

class Notification {
  - notification_id: String
  - user_id: String
  - title: String
  - body: String
  - task_id: String
  - type: NotificationType
  - created_at: DateTime
  - read: Boolean
  - email_sent: Boolean
  - email_sent_at: DateTime
  + createNotification(): Notification
  + markAsRead(): void
  + sendEmail(): Boolean
}

class Report {
  + generateTaskCompletionReport(start_date: DateTime, end_date: DateTime): Dict
  + generateWeeklySummary(user_id: String): Dict
  + getTeamPerformance(manager_id: String): Dict
  + getTaskStatistics(): Dict
}

' Relationships
User "1" -- "0..*" Task : creates
User "1" -- "0..*" Task : assigned to
User "1" -- "0..*" Note : authors
User "1" -- "0..*" Attachment : uploads
User "1" -- "0..*" Notification : receives
User "1" -- "0..*" Membership : has
User "1" -- "0..*" User : manages

Project "1" -- "0..*" Task : contains
Project "1" -- "0..*" Membership : has
Project "1" -- "1" User : owned by

Task "1" -- "0..*" Note : has
Task "1" -- "0..*" Attachment : has
Task "1" -- "0..*" Subtask : has
Task "1" -- "0..*" Notification : triggers
Task "0..*" -- "0..*" String : tagged with (tags array)

Membership "*" -- "1" Project
Membership "*" -- "1" User

Subtask "*" -- "1" Task : belongs to

note right of Task
  **Priority**: Integer scale 1-10
  (1 = lowest, 10 = highest)
  Default value: 5
  
  **Tags**: Simple string array
  stored directly on Task.
  Max 3 tags per task, 
  max 12 chars per tag.
  No separate Tag entity.
end note

@enduml