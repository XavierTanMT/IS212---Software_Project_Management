@startuml c3_backend
!include <C4/C4_Component>

title C3 - Component Diagram (Backend API Server)

Container(webApp, "Web Application", "HTML/CSS/JavaScript", "Frontend")
ContainerDb(firestore, "Firestore Database", "Firebase Firestore", "NoSQL Database")
Container(fileStorage, "File Storage", "File System", "Local storage")
System_Ext(emailService, "Email Service", "SMTP")

Container_Boundary(apiServer, "Flask API Server") {
    Component(usersAPI, "Users API", "Flask Blueprint: /api/users", "User authentication (login), CRUD operations, role management, profile data")
    Component(tasksAPI, "Tasks API", "Flask Blueprint: /api/tasks", "Task CRUD, assignments, status updates, archiving, recurring tasks, subtask management")
    Component(projectsAPI, "Projects API", "Flask Blueprint: /api/projects", "Project CRUD, project-task associations, project archiving")
    Component(notesAPI, "Notes API", "Flask Blueprint: /api/notes", "Task notes/comments with @mentions support, note editing and deletion")
    Component(tagsAPI, "Tags API", "Flask Blueprint: /api/tags", "Tag management (simple string tags stored on tasks, max 3 per task)")
    Component(attachmentsAPI, "Attachments API", "Flask Blueprint: /api/attachments", "File upload/download for tasks, attachment metadata management")
    Component(membershipsAPI, "Memberships API", "Flask Blueprint: /api/memberships", "Project member management, role assignments (owner/member/viewer)")
    Component(notificationsAPI, "Notifications API", "Flask Blueprint: /api/notifications", "In-app notifications, deadline alerts, mention notifications, email notifications")
    Component(dashboardAPI, "Dashboard API", "Flask Blueprint: /api/dashboard", "Task statistics, charts, recent activities, workload analytics")
    Component(reportsAPI, "Reports API", "Flask Blueprint: /api/reports", "Task completion reports, weekly summaries, team performance analytics")
    Component(managerAPI, "Manager API", "Flask Blueprint: /api/manager", "Manager-specific views, team member management, task oversight")
    Component(staffAPI, "Staff API", "Flask Blueprint: /api/staff", "Staff-specific views, personal task dashboard")
    Component(adminAPI, "Admin API", "Flask Blueprint: /api/admin", "System diagnostics, user management, system-wide operations")
    Component(emailUtils, "Email Utilities", "Python Module", "SMTP email sending utility for notifications")
    Component(firebaseUtils, "Firebase Utilities", "Python Module", "Firebase credential loading, client initialization, emulator support")
}

Rel(webApp, usersAPI, "Login, user operations", "JSON/HTTPS")
Rel(webApp, tasksAPI, "Task operations, subtask management", "JSON/HTTPS")
Rel(webApp, projectsAPI, "Project operations", "JSON/HTTPS")
Rel(webApp, notesAPI, "Add/view/edit notes", "JSON/HTTPS")
Rel(webApp, tagsAPI, "Manage tags", "JSON/HTTPS")
Rel(webApp, attachmentsAPI, "Upload/download files", "Multipart/HTTPS")
Rel(webApp, membershipsAPI, "Manage project members", "JSON/HTTPS")
Rel(webApp, notificationsAPI, "Get/mark notifications", "JSON/HTTPS")
Rel(webApp, dashboardAPI, "Dashboard data", "JSON/HTTPS")
Rel(webApp, reportsAPI, "Generate reports", "JSON/HTTPS")
Rel(webApp, managerAPI, "Manager views", "JSON/HTTPS")
Rel(webApp, staffAPI, "Staff views", "JSON/HTTPS")
Rel(webApp, adminAPI, "Admin operations", "JSON/HTTPS")

Rel(usersAPI, firestore, "Read/write users collection", "Firebase Admin SDK")
Rel(tasksAPI, firestore, "Read/write tasks, subtasks collections", "Firebase Admin SDK")
Rel(projectsAPI, firestore, "Read/write projects collection", "Firebase Admin SDK")
Rel(notesAPI, firestore, "Read/write notes collection", "Firebase Admin SDK")
Rel(tagsAPI, firestore, "Read tags from tasks collection", "Firebase Admin SDK")
Rel(attachmentsAPI, firestore, "Read/write attachments collection", "Firebase Admin SDK")
Rel(membershipsAPI, firestore, "Read/write memberships collection", "Firebase Admin SDK")
Rel(notificationsAPI, firestore, "Read/write notifications collection", "Firebase Admin SDK")
Rel(dashboardAPI, firestore, "Read tasks, users, projects", "Firebase Admin SDK")
Rel(reportsAPI, firestore, "Read tasks, analytics data", "Firebase Admin SDK")
Rel(managerAPI, firestore, "Read team data", "Firebase Admin SDK")
Rel(staffAPI, firestore, "Read user tasks", "Firebase Admin SDK")
Rel(adminAPI, firestore, "Read system data", "Firebase Admin SDK")

Rel(attachmentsAPI, fileStorage, "Store/retrieve files", "File I/O")
Rel(notificationsAPI, emailUtils, "Send notification emails")
Rel(emailUtils, emailService, "Send emails", "SMTP")

Rel(usersAPI, firebaseUtils, "Initialize Firebase, get client")
Rel(tasksAPI, firebaseUtils, "Get Firestore client")
Rel(projectsAPI, firebaseUtils, "Get Firestore client")

@enduml