@startuml c3_backend
!include <C4/C4_Component>

title C3 - Component Diagram (Backend API Server)

Container(webApp, "Web Application", "HTML/CSS/JavaScript", "Frontend")
ContainerDb(firestore, "Firestore Database", "Firebase Firestore", "NoSQL Database")
Container(fileStorage, "File Storage", "File System", "Local storage")
System_Ext(emailService, "Email Service", "SMTP")

Container_Boundary(apiServer, "Flask API Server") {
    Component(authAPI, "Authentication API", "Flask Blueprint: /api/users/login", "Firebase Auth integration, session management")
    Component(usersAPI, "Users API", "Flask Blueprint: /api/users", "User CRUD, role management, profile data")
    Component(tasksAPI, "Tasks API", "Flask Blueprint: /api/tasks", "Task CRUD, assignments, status updates, archiving, recurring tasks, subtasks")
    Component(projectsAPI, "Projects API", "Flask Blueprint: /api/projects", "Project CRUD, project-task associations")
    Component(notesAPI, "Notes API", "Flask Blueprint: /api/notes", "Task notes/comments with @mentions support")
    Component(labelsAPI, "Labels API", "Flask Blueprint: /api/labels", "Label CRUD, task-label assignments")
    Component(attachmentsAPI, "Attachments API", "Flask Blueprint: /api/attachments", "File upload/download for tasks")
    Component(membershipsAPI, "Memberships API", "Flask Blueprint: /api/memberships", "Project member management")
    Component(notificationsAPI, "Notifications API", "Flask Blueprint: /api/notifications", "In-app notifications, deadline alerts, mention notifications")
    Component(dashboardAPI, "Dashboard API", "Flask Blueprint: /api/dashboard", "Task statistics, team insights, workload analytics")
    Component(reportsAPI, "Reports API", "Flask Blueprint: /api/reports", "Task completion reports, weekly summaries, team performance")
    Component(managerAPI, "Manager API", "Flask Blueprint: /api/manager", "Manager-specific views, team management")
    Component(staffAPI, "Staff API", "Flask Blueprint: /api/staff", "Staff-specific views, personal dashboard")
    Component(adminAPI, "Admin API", "Flask Blueprint: /api/admin", "System diagnostics, user management")
    Component(emailUtils, "Email Utilities", "Python Module", "SMTP email sending for notifications")
    Component(firebaseUtils, "Firebase Utilities", "Python Module", "Firebase credential loading, initialization")
}

Rel(webApp, authAPI, "Login, authenticate", "JSON/HTTPS")
Rel(webApp, usersAPI, "User operations", "JSON/HTTPS")
Rel(webApp, tasksAPI, "Task operations", "JSON/HTTPS")
Rel(webApp, projectsAPI, "Project operations", "JSON/HTTPS")
Rel(webApp, notesAPI, "Add/view notes", "JSON/HTTPS")
Rel(webApp, labelsAPI, "Manage labels", "JSON/HTTPS")
Rel(webApp, attachmentsAPI, "Upload/download files", "Multipart/HTTPS")
Rel(webApp, membershipsAPI, "Manage project members", "JSON/HTTPS")
Rel(webApp, notificationsAPI, "Get notifications", "JSON/HTTPS")
Rel(webApp, dashboardAPI, "Dashboard data", "JSON/HTTPS")
Rel(webApp, reportsAPI, "Generate reports", "JSON/HTTPS")
Rel(webApp, managerAPI, "Manager views", "JSON/HTTPS")
Rel(webApp, staffAPI, "Staff views", "JSON/HTTPS")
Rel(webApp, adminAPI, "Admin operations", "JSON/HTTPS")

Rel(authAPI, firestore, "Read/write users", "Firebase Admin SDK")
Rel(usersAPI, firestore, "Read/write users", "Firebase Admin SDK")
Rel(tasksAPI, firestore, "Read/write tasks", "Firebase Admin SDK")
Rel(projectsAPI, firestore, "Read/write projects", "Firebase Admin SDK")
Rel(notesAPI, firestore, "Read/write notes", "Firebase Admin SDK")
Rel(labelsAPI, firestore, "Read/write labels", "Firebase Admin SDK")
Rel(attachmentsAPI, firestore, "Read/write attachment metadata", "Firebase Admin SDK")
Rel(membershipsAPI, firestore, "Read/write memberships", "Firebase Admin SDK")
Rel(notificationsAPI, firestore, "Read/write notifications", "Firebase Admin SDK")
Rel(dashboardAPI, firestore, "Read tasks, users, projects", "Firebase Admin SDK")
Rel(reportsAPI, firestore, "Read tasks, analytics data", "Firebase Admin SDK")
Rel(managerAPI, firestore, "Read team data", "Firebase Admin SDK")
Rel(staffAPI, firestore, "Read user tasks", "Firebase Admin SDK")
Rel(adminAPI, firestore, "Read system data", "Firebase Admin SDK")

Rel(attachmentsAPI, fileStorage, "Store/retrieve files", "File I/O")
Rel(notificationsAPI, emailUtils, "Send notification emails")
Rel(emailUtils, emailService, "Send emails", "SMTP")

Rel(authAPI, firebaseUtils, "Initialize Firebase")
Rel(usersAPI, firebaseUtils, "Get Firestore client")

@enduml